language: node_js
dist: trusty
addons:
  apt:
    packages:
      # This is required to run new chrome on old trusty
      - libnss3
notifications:
  email: false
cache:
  directories:
    - node_modules
# allow headful tests
before_install:
  - "sysctl kernel.unprivileged_userns_clone=1"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
script:
  - 'if [ "$NODE8" = "true" ]; then npm run lint; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run coverage; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run test-doclint; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run bundle; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run unit-bundle; fi'
  - 'if [ "$NODE6" = "true" ]; then npm run unit-node6; fi'
jobs:
  include:
    - node_js: "8.11.3"
      env: NODE8=true
    - node_js: "6.12.3"
      env: NODE6=true
before_deploy: "npm run apply-next-version"
deploy:
  provider: npm
  email: aslushnikov@gmail.com
  api_key:
    secure: ZXkIdl7qhcCixwCYdOnlZ0nTTwM8pfW1lhqx1iHk8AfDN2SphkujdeQuhuzi4MQmD5hO3Np41mLOmMDexHOQS8Gyf2woEeDJE4VQw5t+VpLv9NRsBGw8clhZOmmG280EhBQlcBtNqJOQ/nvgV96zOBnarhHH5OEh23UR8U1NyxWuDHAZlUIHU8uiz2JLHNfBEMGAWRypjWMQT7uoz2lwZqVwuAmDTnxHElnhYIsg5V60Qxo84/gx+IwmApQW+l0mkWG/0tt4sImI7At/tFl3BHOzlQK+6je4l89Hhprb/nvpu1Gqk4QlsP0ahXxRZ8gUsB0NsbtIdYzjusukOy8v1BERJDMzcEkQutJODDJjjvd1vx2ddCilMPK24I0LWP+NnrRv72GsILwtkh+2vbKquo16rAPEJqNKKgfj8v86uLpj3vpSDIgLw/wsNEa+grOiAhn8nqZo4wbIXfxfx9qYEg1Womx1zZJXYZq1c+kBUcesUdhbMW1Lw6GwJatgU7i9DnR6hZ8iZPTL5RQjVXJLYk38InMpOGMJLHuzgolaG+W4BGfNAA3J/zVPFoZhyDuyFbS4JHsBoZmkhZMn49+Ggz2/QsK6qFJXnUytcwnFCNczZ0ujg8PI0BZIFL0cGiSpPZP3Rm4QqpUF8fJPaxKXblaiDWPZuvHI7pwElWxuMfY=
  on:
    branch: master
    condition: "$NODE8 = true"
  skip_cleanup: true
  tag: next
