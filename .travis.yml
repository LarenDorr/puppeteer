language: node_js
dist: trusty
addons:
  apt:
    packages:
      # This is required to run new chrome on old trusty
      - libnss3
notifications:
  email: false
cache:
  directories:
    - node_modules
# allow headful tests
before_install:
  - "sysctl kernel.unprivileged_userns_clone=1"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
script:
  - 'if [ "$NODE8" = "true" ]; then npm run lint; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run coverage; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run test-doclint; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run bundle; fi'
  - 'if [ "$NODE8" = "true" ]; then npm run unit-bundle; fi'
  - 'if [ "$NODE6" = "true" ]; then npm run unit-node6; fi'
jobs:
  include:
    - node_js: "8.11.3"
      env: NODE8=true
    - node_js: "6.12.3"
      env: NODE6=true
before_deploy: "npm run apply-next-version"
deploy:
  provider: npm
  email: aslushnikov@gmail.com
  api_key:
    secure: KGnYnr2xvszDqSf6ochCynlSaHCIaTg3hjITTLA4a7g1KvihXi81da3Ze0JVOO4femTqtCK5RibB20NhDfYrQIAAk2TjPbnl8xZnT8iW/oy5FfKN9gj36ys5s0Meqrvr4B1il+Bt43IG8M5A1231C7XOGG8ry0fDVjRVanAShHsVg4MUQVJC4ztwVE4VbbIYumPlKOK80i2LB0fIRPdySDXZqlCoCZgBXIw1JYELmJgshuMkPAnrCK0Qz7Q9P1yrl+Ku7Wg/0pqzQ+0N54WiGRzC+zNMx9vWAgKOZS6MtXnuFHFWeql+XE+o1rIn4n2al59+0wucjGfs5n1gOlqD8AK7bNZMKlOpDX3MS77eSDFMNddRpWe1Zo48y56+ArvHDA9l7XGtZ4i48D1vQj5jlFsCyN8JZTohLoKH6+8L9nwvujBII5kXJ+chnj+QS/RXLr+qs7KX5cr5pHfqGPG3hvdwHQ6daM6Y18DF4NlAt4p1i6iYANJjRBHHP3ovB2mc5KVijG/Jo++Qasp7NKY/k1vJr0Nt5tE0X7DHjE2XerIqp0ayBljYzvo7CiiuuNsSOsP5KP9N1jKaJfjjSPBOskCcHmuHeCDZUslJf+LOGsq7oWMNWEItISpiFbeTqcjB7vA/Jj2AmzA+8GY85DvJCMB3XlWWKla4odVU+JSbTNM=
  on:
    branch: master
    condition: "$NODE8 = true"
  skip_cleanup: true
  tag: next
